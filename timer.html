<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>타이머</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            text-align: center; 
            margin: 0;
            background: linear-gradient(135deg, #e3f0ff 0%, #b3c6ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        #timer {
            width: 70vw;
            max-width: 340px;
            min-width: 200px;
            height: 90px;
            max-height: 110px;
            min-height: 70px;
            font-size: 8vw;
            max-font-size: 54px;
            min-font-size: 32px;
            margin: 40px auto 24px auto;
            background: linear-gradient(135deg, #232a34 60%, #4f8cff 100%);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(30,60,114,0.18), 0 2px 8px rgba(79,140,255,0.12);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: box-shadow 0.2s, background 0.3s;
            border: 3px solid #b3c6ff;
            letter-spacing: 2px;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            user-select: none;
            gap: 8px;
            padding: 0 24px;
        }
        #timer.active {
            box-shadow: 0 0 0 8px #ff4f4f33 inset, 0 8px 32px rgba(255,79,79,0.18);
            background: linear-gradient(135deg, #ff4f4f 60%, #232a34 100%);
            border-color: #ff4f4f;
        }
        #timer .timer-num {
            font-family: 'Segoe UI', 'Arial Black', Arial, sans-serif;
            font-size: 2.8em;
            font-weight: 900;
            background: linear-gradient(90deg, #fff 40%, #b3c6ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 12px #1e3c7244, 0 1px 0 #fff, 0 0px 8px #4f8cff33;
            letter-spacing: 2px;
            margin: 0 2px;
            transition: color 0.2s, text-shadow 0.2s;
            min-width: 48px;
            text-align: center;
            display: inline-block;
        }
        #timer .timer-colon {
            font-size: 2.2em;
            font-weight: 700;
            color: #fff;
            opacity: 0.7;
            margin: 0 0.5vw;
            text-shadow: 0 2px 8px #1e3c7233;
            display: inline-block;
            min-width: 18px;
        }
        #timer.active .timer-num {
            background: linear-gradient(90deg, #fff 40%, #ff4f4f 100%);
            text-shadow: 0 2px 16px #ff4f4f66, 0 1px 0 #fff, 0 0px 8px #ff4f4f33;
        }
        @media (max-width: 600px) {
            #timer {
                width: 96vw;
                height: 18vw;
                min-height: 60px;
                max-height: 80px;
                font-size: 10vw;
                margin: 24px auto 16px auto;
                padding: 0 8vw;
            }
            #timer .timer-num {
                font-size: 2.2em;
                min-width: 32px;
            }
            #timer .timer-colon {
                font-size: 1.6em;
                min-width: 12px;
            }
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }
        button { 
            font-size: 5vw;
            min-font-size: 18px;
            max-font-size: 22px;
            margin: 6px 4px;
            padding: 12px 0;
            width: 28vw;
            min-width: 90px;
            max-width: 140px;
            border: none;
            border-radius: 28px;
            background: linear-gradient(90deg, #4f8cff 60%, #1e90ff 100%);
            color: #fff;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            box-shadow: 0 2px 8px rgba(79,140,255,0.10);
            font-weight: 500;
        }
        button:hover, button:active {
            background: linear-gradient(90deg, #1e90ff 60%, #4f8cff 100%);
            transform: translateY(-2px) scale(1.04);
        }
    </style>
</head>
<body>
    <div id="timer" onclick="stopAllSounds()" title="알람 종료">
        <span class="timer-num hour">00</span>
        <span class="timer-colon">:</span>
        <span class="timer-num min">00</span>
        <span class="timer-colon">:</span>
        <span class="timer-num sec">00</span>
    </div>
    <div class="btn-group">
        <button onclick="addMinutes(10)">+10분</button>
        <button onclick="addMinutes(1)">+1분</button>
        <button onclick="addSeconds(10)">+10초</button>
    </div>
    <div class="btn-group">
        <button id="startPauseBtn" onclick="toggleTimer()">시작</button>
        <button onclick="resetTimer()">초기화</button>
    </div>
    <audio id="alarmSound" src="end.mp3"></audio>
    <audio id="fiveSecSound" src="5second.mp3"></audio>
    <audio id="fiveMinSound" src="5min.mp3"></audio>
    <audio id="tenMinSound" src="10min.mp3"></audio>
    <script>
        let timer;
        let seconds = 0;
        let isRunning = false;
        let startTimestamp = null; // 타이머 시작 시점(밀리초)
        let targetTimestamp = null; // 타이머 종료 예정 시점(밀리초)
        const alarm = document.getElementById('alarmSound');
        const fiveSec = document.getElementById('fiveSecSound');
        const fiveMin = document.getElementById('fiveMinSound');
        const tenMin = document.getElementById('tenMinSound');
        let fiveSecPlayed = false;
        let fiveMinPlayed = false;
        let tenMinPlayed = false;
        let audioUnlocked = false;

        function updateDisplay() {
            const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            document.getElementById('timer').textContent = `${hrs}:${mins}:${secs}`;
        }

        function unlockAudio() {
            if (!audioUnlocked) {
                alarm.play().then(() => {
                    alarm.pause();
                    alarm.currentTime = 0;
                }).catch(()=>{});
                fiveSec.play().then(() => {
                    fiveSec.pause();
                    fiveSec.currentTime = 0;
                }).catch(()=>{});
                fiveMin.play().then(() => {
                    fiveMin.pause();
                    fiveMin.currentTime = 0;
                }).catch(()=>{});
                tenMin.play().then(() => {
                    tenMin.pause();
                    tenMin.currentTime = 0;
                }).catch(()=>{});
                audioUnlocked = true;
            }
        }

        function toggleTimer() {
            unlockAudio();
            if (!isRunning && seconds > 0) {
                startTimer();
            } else {
                pauseTimer();
            }
            updateStartPauseBtn();
        }

        function startTimer() {
            if (!isRunning && seconds > 0) {
                isRunning = true;
                fiveSecPlayed = false;
                fiveMinPlayed = false;
                tenMinPlayed = false;
                document.getElementById('timer').classList.add('active');
                startTimestamp = Date.now();
                targetTimestamp = startTimestamp + seconds * 1000;
                timer = setInterval(() => {
                    const now = Date.now();
                    let remaining = Math.round((targetTimestamp - now) / 1000);
                    if (remaining < 0) remaining = 0;
                    seconds = remaining;

                    // 10분(600초) 남았을 때
                    if (seconds === 600 && !tenMinPlayed) {
                        playTenMin();
                        tenMinPlayed = true;
                    }
                    // 5분(300초) 남았을 때
                    if (seconds === 300 && !fiveMinPlayed) {
                        playFiveMin();
                        fiveMinPlayed = true;
                    }
                    // 5초 남았을 때
                    if (seconds === 5 && !fiveSecPlayed) {
                        playFiveSec();
                        fiveSecPlayed = true;
                    }
                    updateDisplay();

                    if (seconds <= 0) {
                        pauseTimer();
                        playAlarm();
                        updateStartPauseBtn();
                    }
                }, 250); // 더 자주 체크하여 정확도 향상
            }
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timer);
            document.getElementById('timer').classList.remove('active');
            // 남은 시간 보존
            if (targetTimestamp) {
                const now = Date.now();
                seconds = Math.round((targetTimestamp - now) / 1000);
                if (seconds < 0) seconds = 0;
            }
            startTimestamp = null;
            targetTimestamp = null;
        }

        function resetTimer() {
            pauseTimer();
            seconds = 0;
            updateDisplay();
            stopAllSounds();
            updateStartPauseBtn();
        }

        function addMinutes(min) {
            seconds += min * 60;
            if (seconds < 0) seconds = 0;
            updateDisplay();
            updateStartPauseBtn();
        }

        function addSeconds(sec) {
            seconds += sec;
            if (seconds < 0) seconds = 0;
            updateDisplay();
            updateStartPauseBtn();
        }

        function updateStartPauseBtn() {
            const btn = document.getElementById('startPauseBtn');
            if (isRunning) {
                btn.textContent = '정지';
            } else {
                btn.textContent = '시작';
            }
        }

        function playAlarm() {
            alarm.currentTime = 0;
            alarm.loop = true;
            alarm.play();
        }

        function playFiveSec() {
            fiveSec.currentTime = 0;
            fiveSec.loop = false;
            fiveSec.play();
        }

        function playFiveMin() {
            fiveMin.currentTime = 0;
            fiveMin.loop = false;
            fiveMin.play();
        }

        function playTenMin() {
            tenMin.currentTime = 0;
            tenMin.loop = false;
            tenMin.play();
        }

        function stopAllSounds() {
            alarm.pause();
            alarm.currentTime = 0;
            alarm.loop = false;
            fiveSec.pause();
            fiveSec.currentTime = 0;
            fiveMin.pause();
            fiveMin.currentTime = 0;
            tenMin.pause();
            tenMin.currentTime = 0;
        }

        updateDisplay();
        updateStartPauseBtn();
    </script>
</body>
</html>
